# Servidor proFTPd: Usuarios virtuales con LDAP
<div style="text-align: justify;"> Al igual que otros muchos servicios proftp puede almacenar la información de autenticación de usuarios en LDAP, por lo que se suele denominar a éstos usuarios virtuales para diferenciarlos de los usuarios reales o del sistema.<br /><br />En Debian lenny al instalar el paquete proftpd, se instala por dependencias el paquete proftpd-mod-ldap, por lo que no deberemos instalar ningún paquete adicional sino &quot;activar&quot; este método de autenticación.<br /><br />Editamos el fichero /etc/proftpd/modules.conf y buscamos la línea:<br /><pre>#LoadModule mod_ldap.c</pre>La descomentamos para que cuando se reinicie el servidor cargue el módulo de LDAP.<br /><br />Editamos el fichero /etc/proftpd/proftpd.conf y buscamos la línea:<br /><pre>#Include /etc/proftpd/ldap.conf</pre>También la descomentamos y editamos el fichero /etc/proftpd/ldap.conf, en el que dejamos las tres líneas siguientes:<br /><pre>LDAPServer ldap://localhost/??sub LDAPDNInfo &quot;cn=admin,dc=cursolinux,dc=net&quot; &quot;asdasd&quot; LDAPDoAuth on &quot;ou=People,dc=cursolinux,dc=net&quot;</pre>Donde especificamos el servidor LDAP, el nombre distinguido del usuario que se conecta, su contraseña y la ubicación de la rama que contiene los usuarios.<br /><br />Además, para que puedan autenticarse usuarios con la shell (/bin/false) hay que descomentar la directiva:<br /><pre>#RequireValidShell off </pre>
  <p>Después de hacer todas estas modificaciones reiniciamos el demonio con:</p><pre>/etc/init.d/proftpd restart </pre>
  <h3>Prueba de funcionamiento</h3>
  <p>Vamos a crear un usuario virtual que tendrá su directorio home en /srv/ftp/usuario y como shell /bin/false para que no pueda nunca abrir una sesión en el sistema. Creamos el fichero usuario-ftp.ldif con el siguiente contenido:<br /></p><pre>dn: cn=ftpusers,ou=Group,dc=cursolinux,dc=net objectClass: posixGroup objectClass: top cn: ftpusers gidNumber: 2002</pre><pre>dn: uid=rigoberta,ou=People,dc=cursolinux,dc=net uid: rigoberta cn: Rigoberta objectclass: account objectclass: posixAccount objectclass: top uidNumber: 2002 gidNumber: 2002 homeDirectory: /srv/ftp/rigoberta userPassword: {MD5}qPXxZ/RPSWTmyZje6CcRDA== loginShell: /bin/false</pre>Y lo añadimos al directorio con:<br /><pre>ldapadd -x -D &quot;cn=admin,dc=cursolinux,dc=net&quot; -W -f usuario-ftp.ldif</pre>Creamos el directorio del usuario y le damos los propietarios y permisos adecuados con:<br /><pre>mkdir -p /srv/ftpusers/rigoberta chgrp 2002 /srv/ftpusers chown 2002 /srv/ftpusers/rigoberta chmod 700 /srv/ftpusers/rigoberta</pre>Finalmente probamos con un cliente ftp la conexión con este usuario.<br /></div>
